# EIP-7702 æ™ºèƒ½è´¦æˆ·åˆçº¦
```
     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
     â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—   â•šâ•â•â•â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ•â•â•â•â–ˆâ–ˆâ•—
     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
     â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â•šâ•â•â•â•â•â–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•
     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘           â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
     â•šâ•â•â•â•â•â•â•â•šâ•â•â•šâ•â•           â•šâ•â•     â•šâ•â•   â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•
```
ä¸€ä¸ªå®Œæ•´çš„ EIP-7702 æ™ºèƒ½è´¦æˆ·å®ç°ï¼Œæ”¯æŒ EOA ä¸´æ—¶å‡çº§ä¸ºæ™ºèƒ½è´¦æˆ·å¹¶æ‰§è¡Œæ‰¹é‡äº¤æ˜“ï¼ŒåŒ…æ‹¬æ ‡å‡†æ‰¹é‡äº¤æ˜“å’Œè‡ªå®šä¹‰hexæ•°æ®æ‰¹é‡äº¤æ˜“åŠŸèƒ½ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

EIP-7702 å…è®¸æ™®é€š EOAï¼ˆExternally Owned Accountï¼‰ä¸´æ—¶å‡çº§ä¸ºæ™ºèƒ½è´¦æˆ·ï¼Œæ‰§è¡Œæ‰¹é‡æ“ä½œåè‡ªåŠ¨æ¢å¤åˆ° EOA çŠ¶æ€ã€‚æœ¬é¡¹ç›®æä¾›äº†å®Œæ•´çš„å®ç°ï¼ŒåŒ…æ‹¬æ ‡å‡†æ‰¹é‡äº¤æ˜“å’Œè‡ªå®šä¹‰hexæ•°æ®æ‰¹é‡äº¤æ˜“åŠŸèƒ½ã€‚

## ğŸ—ï¸ æ ¸å¿ƒç‰¹æ€§

### åŸºç¡€åŠŸèƒ½
- âœ… **EOA ä¸´æ—¶å‡çº§** - å°†æ™®é€šè´¦æˆ·ä¸´æ—¶å‡çº§ä¸ºæ™ºèƒ½è´¦æˆ·
- âœ… **æ‰¹é‡äº¤æ˜“æ‰§è¡Œ** - æ”¯æŒä¸€æ¬¡æ€§æ‰§è¡Œå¤šä¸ªäº¤æ˜“
- âœ… **ç­¾åéªŒè¯** - ä½¿ç”¨ ECDSA ç­¾åç¡®ä¿å®‰å…¨æ€§
- âœ… **é˜²é‡æ”¾æ”»å‡»** - é€šè¿‡ nonce æœºåˆ¶é˜²æ­¢é‡æ”¾
- âœ… **è‡ªåŠ¨çŠ¶æ€æ¢å¤** - æ‰§è¡Œå®Œæˆåè‡ªåŠ¨æ¢å¤åˆ° EOA çŠ¶æ€

### æ ‡å‡†æ‰¹é‡äº¤æ˜“åŠŸèƒ½
- âœ… **æ ‡å‡†äº¤æ˜“æ ¼å¼** - æ”¯æŒæ ‡å‡†çš„ to/value/data äº¤æ˜“æ ¼å¼
- âœ… **ABI è§£æ** - è‡ªåŠ¨è§£æå’Œæ˜¾ç¤ºå‡½æ•°è°ƒç”¨ä¿¡æ¯
- âœ… **å®‰å…¨éªŒè¯** - å†…ç½®åœ°å€ç™½åå•å’Œé‡‘é¢é™åˆ¶
- âœ… **ç¯å¢ƒé…ç½®** - é€šè¿‡ç¯å¢ƒå˜é‡çµæ´»é…ç½®

### Hex æ‰¹é‡äº¤æ˜“åŠŸèƒ½
- âœ… **è‡ªå®šä¹‰Hexæ•°æ®** - æ”¯æŒä»»æ„hexæ ¼å¼çš„äº¤æ˜“æ•°æ®
- âœ… **åˆçº¦è°ƒç”¨æ”¯æŒ** - æ”¯æŒæ™ºèƒ½åˆçº¦å‡½æ•°è°ƒç”¨
- âœ… **ETHè½¬è´¦** - æ”¯æŒç®€å•çš„ETHè½¬è´¦
- âœ… **å®‰å…¨éªŒè¯** - å†…ç½®åœ°å€ç™½åå•å’Œé‡‘é¢é™åˆ¶
- âœ… **ç¯å¢ƒé…ç½®** - é€šè¿‡ç¯å¢ƒå˜é‡çµæ´»é…ç½®

## ğŸ“ é¡¹ç›®ç»“æ„

```
eip-7702/
â”œâ”€â”€ contract/
â”‚   â””â”€â”€ SendBatchTransactions.sol      # æ ¸å¿ƒæ™ºèƒ½è´¦æˆ·åˆçº¦
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ standard-batch.js              # æ ‡å‡†æ‰¹é‡äº¤æ˜“è„šæœ¬
â”‚   â””â”€â”€ hex-batch.js                   # Hexæ‰¹é‡äº¤æ˜“è„šæœ¬
â”œâ”€â”€ call_data/
â”‚   â”œâ”€â”€ standard-batch-config.json     # æ ‡å‡†æ‰¹é‡äº¤æ˜“é…ç½®
â”‚   â”œâ”€â”€ hex-batch-config.json          # Hexæ‰¹é‡äº¤æ˜“é…ç½®
â”‚   â”œâ”€â”€ STANDARD_BATCH_CONFIG_GUIDE.md # æ ‡å‡†æ‰¹é‡äº¤æ˜“é…ç½®æŒ‡å—
â”‚   â””â”€â”€ HEX_BATCH_CONFIG_GUIDE.md      # Hexæ‰¹é‡äº¤æ˜“é…ç½®æŒ‡å—
â”œâ”€â”€ deploy.sh                          # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ foundry.toml                       # Foundry é…ç½®
â”œâ”€â”€ remappings.txt                     # ä¾èµ–é‡æ˜ å°„
â”œâ”€â”€ package.json                       # Node.js é¡¹ç›®é…ç½®
â”œâ”€â”€ CONTRACT_VERIFICATION_GUIDE.md     # åˆçº¦éªŒè¯ï¼ˆå¼€æºï¼‰æŒ‡å—
â”œâ”€â”€ .env                               # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ .gitignore                         # Git å¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md                          # é¡¹ç›®è¯´æ˜
```

## ğŸ–¥ï¸ æ”¯æŒç³»ç»Ÿ

- ![Windows](https://img.shields.io/badge/-Windows-0078D6?logo=windows&logoColor=white)
- ![macOS](https://img.shields.io/badge/-macOS-000000?logo=apple&logoColor=white)
- ![Linux](https://img.shields.io/badge/-Linux-FCC624?logo=linux&logoColor=black)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†ä»“åº“å¹¶è¿›å…¥é¡¹ç›®ç›®å½•
âš ï¸ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å‰ï¼Œè¯·ç¡®ä¿å·²å®‰è£…äº† `git`
```
git clone https://github.com/oxmoei/eip-7702.git && cd eip-7702
```
### 2. ç¯å¢ƒå‡†å¤‡/å®‰è£…ä¾èµ–

- **Linux/WSL/macOS ç”¨æˆ·ï¼š**
```bash
./install.sh
```

- **Windows ç”¨æˆ·ï¼š**
ä»¥ç®¡ç†å‘˜èº«ä»½å¯åŠ¨ PowerShellï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤
```powershell
.\install.ps1
```

### 3. é…ç½®ç¯å¢ƒå˜é‡
ç¼–è¾‘ `.env` ï¼Œæ ¹æ®æç¤ºå¡«å†™å„é¡¹é…ç½®

### 4. éƒ¨ç½²åˆçº¦

```bash
# è¿è¡Œéƒ¨ç½²è„šæœ¬
./deploy.sh
```

### 4. æ‰§è¡Œæ‰¹é‡äº¤æ˜“
```bash
# æ‰§è¡Œæ ‡å‡†æ‰¹é‡äº¤æ˜“
node src/standard-batch.js

# æ‰§è¡Œ Hex æ‰¹é‡äº¤æ˜“
node src/hex-batch.js
```

## ğŸ“¦ ä¾èµ–é¡¹

### Foundry ä¾èµ–é¡¹
- `@openzeppelin/contracts` - OpenZeppelin æ™ºèƒ½åˆçº¦åº“
- `forge-std` - Foundry æ ‡å‡†åº“

### Node.js ä¾èµ–é¡¹
- `viem` - ä»¥å¤ªåŠå®¢æˆ·ç«¯åº“
- `dotenv` - ç¯å¢ƒå˜é‡ç®¡ç†
- `chalk` - ç»ˆç«¯é¢œè‰²è¾“å‡º

## ğŸ“‹ æ ¸å¿ƒåˆçº¦

### EIP7702SmartAccount.sol

ä¸»è¦çš„æ™ºèƒ½è´¦æˆ·åˆçº¦ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š

#### åŸºç¡€åŠŸèƒ½
- **validateAuthorization** - éªŒè¯ EIP-7702 æˆæƒç­¾å
- **executeBatchWithAuthorization** - æ‰§è¡Œæ‰¹é‡äº¤æ˜“ï¼ˆå¸¦æˆæƒï¼‰
- **executeWithAuthorization** - æ‰§è¡Œå•ç¬”äº¤æ˜“ï¼ˆå¸¦æˆæƒï¼‰
- **executeBatch** - ç›´æ¥æ‰§è¡Œæ‰¹é‡äº¤æ˜“
- **execute** - ç›´æ¥æ‰§è¡Œå•ç¬”äº¤æ˜“

#### Hex æ‰¹é‡äº¤æ˜“åŠŸèƒ½
- **executeHexBatchWithAuthorization** - æ‰§è¡Œhexæ‰¹é‡äº¤æ˜“ï¼ˆå¸¦æˆæƒï¼‰
- **executeHexWithAuthorization** - æ‰§è¡Œå•ç¬”hexäº¤æ˜“ï¼ˆå¸¦æˆæƒï¼‰
- **executeHexBatch** - ç›´æ¥æ‰§è¡Œhexæ‰¹é‡äº¤æ˜“
- **executeHex** - ç›´æ¥æ‰§è¡Œå•ç¬”hexäº¤æ˜“

## ğŸ¯ æ‰¹é‡äº¤æ˜“ä½¿ç”¨

### ğŸ”´ æ ‡å‡†æ‰¹é‡äº¤æ˜“

#### 1. é…ç½®æ–‡ä»¶

ç¼–è¾‘ `call_data/standard-batch-config.json`ï¼š

```json
{
  "transactions": [
    {
      "target": "0xd9c5d6111983ea3692f1d29bec4ac7d6f723217a",
      "value": "100000000000000000",
      "data": "0x",
      "description": "å‘åœ°å€0xd9c5d6111983ea3692f1d29bec4ac7d6f723217aå‘é€0.1ETH"
    },
    {
      "target": "0xdac17f958d2ee523a2206206994597c13d831ec7",
      "value": "0",
      "abi": {
        "name": "transfer",
        "type": "function",
        "inputs": [
          {
            "name": "to",
            "type": "address"
          },
          {
            "name": "amount",
            "type": "uint256"
          }
        ],
        "outputs": [
          {
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "nonpayable"
      },
      "params": [
        "0x9d5befd138960ddf0dc4368a036bfad420e306ef",
        "1000000"
      ],
      "description": "å°†1ä»£å¸ï¼ˆåˆçº¦ï¼š0xdac17f958d2ee523a2206206994597c13d831ec7ï¼‰è½¬è´¦ç»™åœ°å€0x9d5befd138960ddf0dc4368a036bfad420e306ef"
    },
    {
      "target": "0xdac17f958d2ee523a2206206994597c13d831ec7",
      "value": "0",
      "abi": {
        "name": "approve",
        "type": "function",
        "inputs": [
          {
            "name": "spender",
            "type": "address"
          },
          {
            "name": "amount",
            "type": "uint256"
          }
        ],
        "outputs": [
          {
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "nonpayable"
      },
      "params": [
        "0x9d5befd138960ddf0dc4368a036bfad420e306ef",
        "1000000000000000000000"
      ],
      "description": "å°†ä»£å¸0xdac17f958d2ee523a2206206994597c13d831ec7æˆæƒç»™åœ°å€0x9d5befd138960ddf0dc4368a036bfad420e306ef"
    }
  ],
  "settings": {
    "maxSingleTransactionValue": "1000000000000000000",
    "maxBatchTotalValue": "5000000000000000000",
    "enableAddressWhitelist": false,
    "allowedTargets": []
  }
}
```

#### 2. æ‰§è¡Œäº¤æ˜“

```bash
node src/standard-batch.js
# æˆ–è€…
npm run standard
```

### ğŸ”´ Hex æ‰¹é‡äº¤æ˜“

#### 1. é…ç½®æ–‡ä»¶

ç¼–è¾‘ `call_data/hex-batch-config.json`ï¼š

```json
{
  "transactions": [
    {
      "target": "0xd9c5d6111983ea3692f1d29bec4ac7d6f723217a",
      "value": "100000000000000000",
      "hexData": "0x",
      "isContractCall": false,
      "description": "å‘åœ°å€0xd9c5d6111983ea3692f1d29bec4ac7d6f723217aå‘é€0.1ETH"
    },
    {
      "target": "0xdac17f958d2ee523a2206206994597c13d831ec7",
      "value": "0",
      "hexData": "0xa9059cbb0000000000000000000000009d5befd138960ddf0dc4368a036bfad420e306e00000000000000000000000000000000000000000000000000000000000f4240",
      "isContractCall": true,
      "description": "å°†1ä»£å¸ï¼ˆåˆçº¦ï¼š0xdac17f958d2ee523a2206206994597c13d831ec7ï¼‰è½¬è´¦ç»™åœ°å€0x9d5befd138960ddf0dc4368a036bfad420e306ef"
    },
    {
      "target": "0xdac17f958d2ee523a2206206994597c13d831ec7",
      "value": "0",
      "hexData": "0x095ea7b30000000000000000000000009d5befd138960ddf0dc4368a036bfad420e306ef000000000000000000000000000000000000000000000000d3c21bcecceda0000000",
      "isContractCall": true,
      "description": "å°†ä»£å¸0xdac17f958d2ee523a2206206994597c13d831ec7æˆæƒç»™åœ°å€0x9d5befd138960ddf0dc4368a036bfad420e306ef"
    } 
  ],
  "settings": {
    "maxSingleTransactionValue": "1000000000000000000",
    "maxBatchTotalValue": "5000000000000000000",
    "enableAddressWhitelist": false,
    "allowedTargets": []
  }
}
```

#### 2. æ‰§è¡Œäº¤æ˜“

```bash
node src/hex-batch.js
# æˆ–è€…
npm run hex
```

è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚è€ƒï¼š
- [æ ‡å‡†æ‰¹é‡äº¤æ˜“é…ç½®æŒ‡å—](call_data/STANDARD_BATCH_CONFIG_GUIDE.md)
- [Hex æ‰¹é‡äº¤æ˜“é…ç½®æŒ‡å—](call_data/HEX_BATCH_CONFIG_GUIDE.md)

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- **ç§é’¥å®‰å…¨** - é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†ï¼Œä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç 
- **åœ°å€éªŒè¯** - æ”¯æŒç™½åå•æœºåˆ¶ï¼Œé˜²æ­¢æ„å¤–è½¬è´¦
- **é‡‘é¢é™åˆ¶** - è®¾ç½®åˆç†çš„äº¤æ˜“é‡‘é¢ä¸Šé™
- **é”™è¯¯å¤„ç†** - å®Œæ•´çš„é”™è¯¯å›æ»šå’Œå¼‚å¸¸å¤„ç†
- **æµ‹è¯•ç½‘ç»œ** - å»ºè®®å…ˆåœ¨æµ‹è¯•ç½‘ç»œä¸ŠéªŒè¯
- **Gas ä¼˜åŒ–** - è‡ªåŠ¨ Gas ä¼°ç®—å’Œç­–ç•¥é€‰æ‹©

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **é…ç½®é”™è¯¯**
   ```
   é”™è¯¯: è¯·è®¾ç½®æœ‰æ•ˆçš„ PRIVATE_KEY
   è§£å†³: æ£€æŸ¥.envæ–‡ä»¶ä¸­çš„ç§é’¥é…ç½®
   ```

2. **åŠŸèƒ½æœªå¯ç”¨**
   ```
   é”™è¯¯: æ ‡å‡†æ‰¹é‡äº¤æ˜“åŠŸèƒ½æœªå¯ç”¨ï¼Œè¯·è®¾ç½® ENABLE_STANDARD_BATCH=true
   è§£å†³: åœ¨.envæ–‡ä»¶ä¸­è®¾ç½®ç›¸åº”çš„åŠŸèƒ½å¼€å…³ä¸ºtrue
   ```

3. **ç½‘ç»œè¿æ¥é—®é¢˜**
   ```
   é”™è¯¯: æ— æ³•è¿æ¥åˆ°RPCèŠ‚ç‚¹
   è§£å†³: æ£€æŸ¥RPC_URLé…ç½®å’Œç½‘ç»œè¿æ¥
   ```

4. **Gasä¸è¶³**
   ```
   é”™è¯¯: Gasä¸è¶³
   è§£å†³: å¢åŠ GAS_LIMITæˆ–æ£€æŸ¥è´¦æˆ·ä½™é¢
   ```

5. **é…ç½®æ–‡ä»¶é”™è¯¯**
   ```
   é”™è¯¯: é…ç½®æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ ¼å¼é”™è¯¯
   è§£å†³: æ£€æŸ¥call_dataç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
   ```

6. **è¯­æ³•é”™è¯¯**
   ```
   é”™è¯¯: SyntaxError: missing ) after argument list
   è§£å†³: æ£€æŸ¥è„šæœ¬æ–‡ä»¶ä¸­çš„è¯­æ³•é”™è¯¯ï¼Œç¡®ä¿æ‰€æœ‰æ‹¬å·åŒ¹é…
   ```

7. **ç¯å¢ƒå˜é‡ç¼ºå¤±**
   ```
   é”™è¯¯: ç¯å¢ƒå˜é‡æœªè®¾ç½®
   è§£å†³: ç¡®ä¿.envæ–‡ä»¶å­˜åœ¨ä¸”åŒ…å«æ‰€æœ‰å¿…éœ€çš„é…ç½®é¡¹
   ```

## ğŸ“š ç›¸å…³é“¾æ¥

- [EIP-7702 è§„èŒƒ](https://eips.ethereum.org/EIPS/eip-7702)
- [OpenZeppelin åˆçº¦](https://openzeppelin.com/contracts/)
- [Viem æ–‡æ¡£](https://viem.sh/)
- [Foundry æ–‡æ¡£](https://book.getfoundry.sh/)

## ğŸ’¬ è”ç³»ä¸æ”¯æŒ
- Telegram: [t.me/cryptostar210](https://t.me/cryptostar210)
- è¯·æˆ‘å–æ¯â˜•ï¼š**0xd328426a8e0bcdbbef89e96a91911eff68734e84** â–‹**5LmGJmv7Lbjh9K1gEer47xSHZ7mDcihYqVZGoPMRo89s**