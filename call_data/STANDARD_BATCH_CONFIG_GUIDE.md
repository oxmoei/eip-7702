# EIP-7702 æ ‡å‡†æ‰¹é‡äº¤æ˜“é…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æ ‡å‡†æ‰¹é‡äº¤æ˜“åŠŸèƒ½å…è®¸æ‚¨æ‰§è¡Œå¤šä¸ªæ ‡å‡†äº¤æ˜“è°ƒç”¨ï¼ŒåŒ…æ‹¬ ETH è½¬è´¦å’Œæ™ºèƒ½åˆçº¦è°ƒç”¨ã€‚ä¸ Hex æ‰¹é‡äº¤æ˜“ä¸åŒï¼Œæ ‡å‡†æ‰¹é‡äº¤æ˜“ä½¿ç”¨æ›´ç®€å•çš„æ•°æ®ç»“æ„ï¼Œæ›´é€‚åˆå¸¸è§çš„æ‰¹é‡æ“ä½œåœºæ™¯ã€‚

## ğŸ”§ ç¯å¢ƒé…ç½®

### 1. å¯ç”¨æ ‡å‡†æ‰¹é‡äº¤æ˜“

åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```bash
# å¯ç”¨æ ‡å‡†æ‰¹é‡äº¤æ˜“
ENABLE_STANDARD_BATCH=true

# æ ‡å‡†æ‰¹é‡äº¤æ˜“é…ç½®æ–‡ä»¶è·¯å¾„ (å¯é€‰ï¼Œé»˜è®¤ä¸º call_data/standard-batch-config.json)
STANDARD_BATCH_CONFIG_FILE=call_data/standard-batch-config.json
```

### 2. å¯é€‰é…ç½®é¡¹

```bash
# æœ€å¤§å•ç¬”äº¤æ˜“é‡‘é¢ (é»˜è®¤: 1 ETH)
MAX_SINGLE_TRANSACTION_VALUE=1000000000000000000

# æœ€å¤§æ‰¹é‡äº¤æ˜“æ€»é‡‘é¢ (é»˜è®¤: 5 ETH)
MAX_BATCH_TOTAL_VALUE=5000000000000000000

# å¯ç”¨åœ°å€ç™½åå• (é»˜è®¤: false)
ENABLE_ADDRESS_WHITELIST=false

# å…è®¸çš„ç›®æ ‡åœ°å€ (é€—å·åˆ†éš”)
ALLOWED_TARGETS=0x1234...,0x5678...
```

## ğŸ“„ é…ç½®æ–‡ä»¶æ ¼å¼

### åŸºæœ¬ç»“æ„

```json
{
  "transactions": [
    {
      "target": "0xç›®æ ‡åœ°å€",
      "value": "äº¤æ˜“é‡‘é¢(wei)",
      "data": "è°ƒç”¨æ•°æ®",
      "description": "äº¤æ˜“æè¿°"
    }
  ],
  "settings": {
    "maxSingleTransactionValue": "æœ€å¤§å•ç¬”äº¤æ˜“é‡‘é¢",
    "maxBatchTotalValue": "æœ€å¤§æ‰¹é‡äº¤æ˜“æ€»é‡‘é¢",
    "enableAddressWhitelist": false,
    "allowedTargets": []
  }
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| `target` | string | âœ… | ç›®æ ‡åˆçº¦æˆ–åœ°å€ |
| `value` | string | âœ… | å‘é€çš„ ETH æ•°é‡ï¼ˆweiï¼‰ |
| `data` | string | âŒ | è°ƒç”¨æ•°æ®ï¼ˆé»˜è®¤ä¸º "0x"ï¼‰ |
| `abi` | object | âŒ | å‡½æ•° ABI å®šä¹‰ |
| `params` | array | âŒ | å‡½æ•°å‚æ•°æ•°ç»„ |
| `description` | string | âŒ | äº¤æ˜“æè¿° |

**æ³¨æ„**: å¦‚æœæä¾›äº† `abi` å’Œ `params`ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ç¼–ç è°ƒç”¨æ•°æ®ã€‚å¦‚æœåªæä¾›äº† `data`ï¼Œåˆ™ç›´æ¥ä½¿ç”¨è¯¥æ•°æ®ã€‚

### é…ç½®ç¤ºä¾‹

#### 1. ETH è½¬è´¦ç¤ºä¾‹

```json
{
  "transactions": [
    {
      "target": "0xcb98643b8786950F0461f3B0edf99D88F274574D",
      "value": "1000000000000000",
      "data": "0x",
      "description": "å‘åœ°å€1å‘é€0.001 ETH"
    },
    {
      "target": "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6",
      "value": "2000000000000000",
      "data": "0x",
      "description": "å‘åœ°å€2å‘é€0.002 ETH"
    }
  ],
  "settings": {
    "maxSingleTransactionValue": "1000000000000000000",
    "maxBatchTotalValue": "5000000000000000000",
    "enableAddressWhitelist": false,
    "allowedTargets": []
  }
}
```

#### 2. ERC20 ä»£å¸æ“ä½œç¤ºä¾‹ï¼ˆä½¿ç”¨ ABIï¼‰

```json
{
  "transactions": [
    {
      "target": "0x6B175474E89094C44Da98b954EedeAC495271d0F",
      "value": "0",
      "abi": {
        "name": "approve",
        "type": "function",
        "inputs": [
          {
            "name": "spender",
            "type": "address"
          },
          {
            "name": "amount",
            "type": "uint256"
          }
        ],
        "outputs": [
          {
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "nonpayable"
      },
      "params": [
        "0xb5c56d5a06a51271523247153b64afacd583a64a",
        "1000000000000000000000"
      ],
      "description": "DAI ä»£å¸æˆæƒ"
    },
    {
      "target": "0xA0b86a33E6441b8C4C8C8C8C8C8C8C8C8C8C8C8",
      "value": "0",
      "abi": {
        "name": "transfer",
        "type": "function",
        "inputs": [
          {
            "name": "to",
            "type": "address"
          },
          {
            "name": "amount",
            "type": "uint256"
          }
        ],
        "outputs": [
          {
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "nonpayable"
      },
      "params": [
        "0xcb98643b8786950F0461f3B0edf99D88F274574D",
        "100"
      ],
      "description": "ERC20 ä»£å¸è½¬è´¦"
    }
  ],
  "settings": {
    "maxSingleTransactionValue": "1000000000000000000",
    "maxBatchTotalValue": "5000000000000000000",
    "enableAddressWhitelist": false,
    "allowedTargets": []
  }
}
```

#### 3. æ··åˆæ“ä½œç¤ºä¾‹ï¼ˆABI + ç›´æ¥æ•°æ®ï¼‰

```json
{
  "transactions": [
    {
      "target": "0xcb98643b8786950F0461f3B0edf99D88F274574D",
      "value": "1000000000000000",
      "data": "0x",
      "description": "ETH è½¬è´¦"
    },
    {
      "target": "0x6B175474E89094C44Da98b954EedeAC495271d0F",
      "value": "0",
      "abi": {
        "name": "approve",
        "type": "function",
        "inputs": [
          {
            "name": "spender",
            "type": "address"
          },
          {
            "name": "amount",
            "type": "uint256"
          }
        ],
        "outputs": [
          {
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "nonpayable"
      },
      "params": [
        "0xb5c56d5a06a51271523247153b64afacd583a64a",
        "1000000000000000000000"
      ],
      "description": "ä»£å¸æˆæƒï¼ˆä½¿ç”¨ABIï¼‰"
    },
    {
      "target": "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6",
      "value": "500000000000000",
      "data": "0x",
      "description": "å¦ä¸€ä¸ª ETH è½¬è´¦"
    }
  ],
  "settings": {
    "maxSingleTransactionValue": "1000000000000000000",
    "maxBatchTotalValue": "5000000000000000000",
    "enableAddressWhitelist": false,
    "allowedTargets": []
  }
}
```

#### 3. æ··åˆæ“ä½œç¤ºä¾‹

```json
{
  "transactions": [
    {
      "target": "0xcb98643b8786950F0461f3B0edf99D88F274574D",
      "value": "1000000000000000",
      "data": "0x",
      "description": "ETH è½¬è´¦"
    },
    {
      "target": "0x6B175474E89094C44Da98b954EedeAC495271d0F",
      "value": "0",
      "data": "0x095ea7b3000000000000000000000000b5c56d5a06a51271523247153b64afacd583a64a000000000000000000000000000000000000000000000000d3c21bcecceda0000000",
      "description": "ä»£å¸æˆæƒ"
    },
    {
      "target": "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6",
      "value": "500000000000000",
      "data": "0x",
      "description": "å¦ä¸€ä¸ª ETH è½¬è´¦"
    }
  ],
  "settings": {
    "maxSingleTransactionValue": "1000000000000000000",
    "maxBatchTotalValue": "5000000000000000000",
    "enableAddressWhitelist": false,
    "allowedTargets": []
  }
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. æ‰§è¡Œè„šæœ¬

```bash
# ç›´æ¥æ‰§è¡Œ
node scripts/eip7702-standard-batch.js

# æˆ–è€…ä½¿ç”¨ npm è„šæœ¬ï¼ˆå¦‚æœå·²é…ç½®ï¼‰
npm run standard
```

### 2. æ‰§è¡Œæµç¨‹

1. **é…ç½®éªŒè¯** - æ£€æŸ¥ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶
2. **ç½‘ç»œæ£€æµ‹** - è‡ªåŠ¨è¯†åˆ«ç½‘ç»œä¿¡æ¯
3. **è´¦æˆ·çŠ¶æ€æ£€æŸ¥** - éªŒè¯ EOA çŠ¶æ€
4. **æˆæƒç”Ÿæˆ** - åˆ›å»º EIP-7702 æˆæƒç­¾å
5. **äº¤æ˜“å‡†å¤‡** - åŠ è½½å’ŒéªŒè¯æ‰¹é‡äº¤æ˜“
6. **äº¤æ˜“æ‰§è¡Œ** - å‘é€æ‰¹é‡äº¤æ˜“åˆ°åŒºå—é“¾
7. **ç¡®è®¤ç­‰å¾…** - ç­‰å¾…äº¤æ˜“ç¡®è®¤
8. **çŠ¶æ€æ£€æŸ¥** - éªŒè¯æœ€ç»ˆçŠ¶æ€

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### 1. é‡‘é¢é™åˆ¶

- **å•ç¬”äº¤æ˜“é™åˆ¶**: é˜²æ­¢å•ç¬”äº¤æ˜“é‡‘é¢è¿‡å¤§
- **æ‰¹é‡æ€»é‡‘é¢é™åˆ¶**: é˜²æ­¢æ‰¹é‡äº¤æ˜“æ€»é‡‘é¢è¿‡å¤§
- **å¯é…ç½®é™åˆ¶**: é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»è®¾ç½®

### 2. åœ°å€ç™½åå•

```json
{
  "settings": {
    "enableAddressWhitelist": true,
    "allowedTargets": [
      "0xcb98643b8786950F0461f3B0edf99D88F274574D",
      "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6"
    ]
  }
}
```

### 3. äº¤æ˜“éªŒè¯

- **åœ°å€æ ¼å¼éªŒè¯**: ç¡®ä¿ç›®æ ‡åœ°å€æ ¼å¼æ­£ç¡®
- **æ•°æ®æ ¼å¼éªŒè¯**: éªŒè¯è°ƒç”¨æ•°æ®æ ¼å¼
- **é‡‘é¢éªŒè¯**: æ£€æŸ¥äº¤æ˜“é‡‘é¢æ˜¯å¦åœ¨å…è®¸èŒƒå›´å†…

## ğŸ“Š ä¸ Hex æ‰¹é‡äº¤æ˜“çš„åŒºåˆ«

| ç‰¹æ€§ | æ ‡å‡†æ‰¹é‡äº¤æ˜“ | Hex æ‰¹é‡äº¤æ˜“ |
|------|-------------|-------------|
| æ•°æ®ç»“æ„ | `Call` ç»“æ„ä½“ | `HexBatchTransaction` ç»“æ„ä½“ |
| å­—æ®µåç§° | `to`, `value`, `data` | `target`, `value`, `hexData`, `isContractCall` |
| æ•°æ®ç¼–ç  | æ”¯æŒ ABI è‡ªåŠ¨ç¼–ç  | éœ€è¦æ‰‹åŠ¨æä¾› hex æ•°æ® |
| é…ç½®æ–¹å¼ | `abi` + `params` æˆ–ç›´æ¥ `data` | ç›´æ¥ `hexData` |
| å¤æ‚åº¦ | ç®€å• | å¤æ‚ |
| é€‚ç”¨åœºæ™¯ | æ ‡å‡†åˆçº¦è°ƒç”¨ | è‡ªå®šä¹‰ hex æ•°æ® |
| é…ç½®éš¾åº¦ | ä½ | ä¸­ç­‰ |
| å¯è¯»æ€§ | é«˜ï¼ˆä½¿ç”¨ ABIï¼‰ | ä½ï¼ˆéœ€è¦ç†è§£ hexï¼‰ |

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯

1. **é…ç½®æ–‡ä»¶ä¸å­˜åœ¨**
   ```
   âŒ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: standard-batch-config.json
   ```
   **è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿é…ç½®æ–‡ä»¶å­˜åœ¨äºé¡¹ç›®æ ¹ç›®å½•

2. **é…ç½®æ ¼å¼é”™è¯¯**
   ```
   âŒ é…ç½®æ–‡ä»¶ JSON æ ¼å¼é”™è¯¯
   ```
   **è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ JSON æ ¼å¼æ˜¯å¦æ­£ç¡®

3. **ç¼ºå°‘å¿…éœ€å­—æ®µ**
   ```
   âŒ äº¤æ˜“ 1: ç¼ºå°‘ target å­—æ®µ
   ```
   **è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿æ¯ä¸ªäº¤æ˜“éƒ½åŒ…å« `target` å’Œ `value` å­—æ®µ

4. **é‡‘é¢è¶…é™**
   ```
   âŒ äº¤æ˜“ 1: å•ç¬”äº¤æ˜“é‡‘é¢è¶…è¿‡é™åˆ¶
   ```
   **è§£å†³æ–¹æ¡ˆ**: è°ƒæ•´äº¤æ˜“é‡‘é¢æˆ–å¢åŠ é™åˆ¶å€¼

5. **åœ°å€ç™½åå•é™åˆ¶**
   ```
   âŒ äº¤æ˜“ 1: ç›®æ ‡åœ°å€ä¸åœ¨ç™½åå•ä¸­
   ```
   **è§£å†³æ–¹æ¡ˆ**: å°†ç›®æ ‡åœ°å€æ·»åŠ åˆ°ç™½åå•æˆ–ç¦ç”¨ç™½åå•åŠŸèƒ½

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**: æ£€æŸ¥è„šæœ¬è¾“å‡ºçš„è¯¦ç»†ä¿¡æ¯
2. **éªŒè¯ç½‘ç»œè¿æ¥**: ç¡®ä¿ RPC ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
3. **æ£€æŸ¥ä½™é¢**: ç¡®ä¿è´¦æˆ·æœ‰è¶³å¤Ÿçš„ ETH æ”¯ä»˜ gas è´¹ç”¨
4. **æµ‹è¯•å°é¢äº¤æ˜“**: å…ˆç”¨å°é¢äº¤æ˜“æµ‹è¯•åŠŸèƒ½

## ğŸ“ æœ€ä½³å®è·µ

1. **å…ˆåœ¨æµ‹è¯•ç½‘æµ‹è¯•**: åœ¨ä¸»ç½‘æ‰§è¡Œå‰å…ˆåœ¨æµ‹è¯•ç½‘éªŒè¯
2. **åˆç†è®¾ç½®é™åˆ¶**: æ ¹æ®å®é™…éœ€æ±‚è®¾ç½®é‡‘é¢é™åˆ¶
3. **ä½¿ç”¨ç™½åå•**: å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®å¯ç”¨åœ°å€ç™½åå•
4. **å¤‡ä»½é…ç½®**: å®šæœŸå¤‡ä»½é‡è¦çš„é…ç½®æ–‡ä»¶
5. **ç›‘æ§æ‰§è¡Œ**: å¯†åˆ‡å…³æ³¨äº¤æ˜“æ‰§è¡ŒçŠ¶æ€å’Œ gas æ¶ˆè€—

## ğŸ”— ç›¸å…³é“¾æ¥

- [EIP-7702 æ ‡å‡†](https://eips.ethereum.org/EIPS/eip-7702)
- [Hex æ‰¹é‡äº¤æ˜“æŒ‡å—](HEX_BATCH_CONFIG_GUIDE.md)
- [åˆçº¦éªŒè¯æŒ‡å—](CONTRACT_VERIFICATION_GUIDE.md)
- [é¡¹ç›® README](README.md)
